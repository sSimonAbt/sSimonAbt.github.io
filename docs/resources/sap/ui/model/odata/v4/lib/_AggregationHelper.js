/*!
 * OpenUI5
 * (c) Copyright 2009-2020 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/thirdparty/jquery","sap/ui/model/Filter"],function(e,r){"use strict";var t={grandTotal:"boolean",max:"boolean",min:"boolean",name:"string",subtotals:"boolean",with:"string"},n={aggregate:"object",group:"object",groupLevels:"array"},i;function o(e,r,t){var n;function i(e){if(t){e+=" at property: "+t}throw new Error(e)}function o(e){return Array.isArray(e)?"array":typeof e}for(n in e){if(!(r&&n in r)){i("Unsupported '"+n+"'")}else if(o(e[n])!==r[n]){i("Not a "+r[n]+" value for '"+n+"'")}}}function a(e,r){var t;for(t in e){o(e[t],r,t)}}i={buildApply:function(r,i,g,u){var f,l="",s=[],p,c,d;function h(e){var t=r.aggregate[e],n=t.name||e,o=e,a=t.with;if(a){if((a==="average"||a==="countdistinct")&&(t.grandTotal||t.subtotals)){throw new Error("Cannot aggregate totals with '"+a+"'")}n+=" with "+a+" as "+e}else if(t.name){n+=" as "+e}if(!u){if(t.min){v(e,"min")}if(t.max){v(e,"max")}}if(t.grandTotal){c=true;if(!i.$skip){if(a){o+=" with "+a+" as UI5grand__"+e}s.push(o)}}return n}function $(e){return r.groupLevels.indexOf(e)<0}function v(e,r){var t="UI5"+r+"__"+e;s.push(e+" with "+r+" as "+t);if(g){g[t]={measure:e,method:r}}}function y(){var e="";if(i.$skip){e="skip("+i.$skip+")"}delete i.$skip;if(i.$top<Infinity){if(e){e+="/"}e+="top("+i.$top+")"}delete i.$top;return e}i=e.extend({},i);o(r,n);r.groupLevels=r.groupLevels||[];if(r.groupLevels.length>1){throw new Error("More than one group level: "+r.groupLevels)}r.aggregate=r.aggregate||{};a(r.aggregate,t);f=Object.keys(r.aggregate).sort().map(h);if(c&&r.groupLevels.length){throw new Error("Cannot combine visual grouping with grand total")}if(f.length){l="aggregate("+f.join(",")+")"}r.group=r.group||{};a(r.group);p=r.groupLevels.concat(Object.keys(r.group).sort().filter($));if(p.length){l="groupby(("+p.join(",")+(l?"),"+l+")":"))")}if(u){delete i.$count}else if(i.$count){s.push("$count as UI5__count");delete i.$count}if(i.$$filterBeforeAggregate){l="filter("+i.$$filterBeforeAggregate+")/"+l;delete i.$$filterBeforeAggregate}if(i.$filter){l+="/filter("+i.$filter+")";delete i.$filter}if(i.$orderby){l+="/orderby("+i.$orderby+")";delete i.$orderby}if(c){if(i.$skip){i.$skip-=1}else{i.$top-=1}}d=y();if(s.length){l+="/concat(aggregate("+s.join(",")+"),"+(d||"identity")+")"}else if(d){l+="/"+d}i.$apply=l;return i},hasGrandTotal:function(e){return!!e&&Object.keys(e).some(function(r){return e[r].grandTotal})},hasMinOrMax:function(e){return!!e&&Object.keys(e).some(function(r){var t=e[r];return t.min||t.max})},splitFilter:function(e,t){var n=[],i=[];function o(e){return e.aFilters?e.aFilters.some(o):e.sPath in t.aggregate}function a(e){if(e.aFilters&&e.bAnd){e.aFilters.forEach(a)}else{(o(e)?n:i).push(e)}}function g(e){return e.length>1?new r(e,true):e[0]}if(!t||!t.aggregate){return[e]}a(e);return[g(n),g(i)]}};return i},false);