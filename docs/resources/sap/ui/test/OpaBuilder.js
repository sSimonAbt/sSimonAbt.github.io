/*!
* OpenUI5
 * (c) Copyright 2009-2020 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
*/
sap.ui.define(["sap/base/util/merge","sap/base/strings/capitalize","sap/ui/test/Opa5","sap/ui/test/actions/Action","sap/ui/test/actions/Press","sap/ui/test/actions/EnterText","sap/ui/test/matchers/Matcher","sap/ui/test/matchers/MatcherFactory","sap/ui/test/pipelines/MatcherPipeline","sap/ui/test/pipelines/ActionPipeline"],function(t,e,n,r,o,i,s,u,a,c){"use strict";function p(){return t.apply(this,[{}].concat(Array.prototype.slice.call(arguments)))}function f(t,e,n){var r=Array.isArray(e)?e:[e];return r.reduce(function(e,r){if(e){return true}if(r===null||r===undefined){return t===r}if(t===null||t===undefined){return!!n}if(typeof r==="function"){if(r===Boolean){return typeof t==="boolean"}if(r===Array){return Array.isArray(t)}if(r===String){return typeof t==="string"||t instanceof String}if(r===Object){return typeof t==="object"&&t.constructor===Object}return t instanceof r}return typeof t===r},false)}function h(t){var e=Array.prototype.slice.call(arguments,1);return t.reduce(function(t,n){if(f(e[0],n,true)){t.push(e.shift())}else{t.push(undefined)}return t},[])}function l(t,e){if(e===undefined){e=[]}else if(!Array.isArray(e)){e=[e]}else{e=e.slice(0)}if(Array.isArray(t)){e=e.concat(t)}else if(t!==undefined){e.push(t)}return e}function g(t,e,n){if(!f(t,Function)){throw new Error("not a function")}if(!f(e,Function)){return t}if(n){return function(n){return e(n)&&t(n)}}return function(n){e(n);t(n)}}function y(t){if(!f(t,Function)){return function(){n.assert.ok(true,t||"Success")}}return t}function d(t){var e="";e+=t.controlType||"Control";e+="#"+(t.id||"<undefined>");e+=t.matchers?" with "+(f(t.matchers,Array)?t.matchers.length:1)+" additional matcher(s)":"";e+=" not found";return e}function m(t,n){if(!t){return null}var r=t["get"+e(n,0)];if(!r){throw new Error("Object '"+t+"' does not have an aggregation called '"+n+"'")}return r.call(t)}function A(t,e){if(t&&e){I.process({actions:t,control:e})}}function O(t,e){return w.process({matchers:M.getFilteringMatchers({matchers:t}),control:e})}function v(t){var e=t.indexOf(">"),n=e===-1?undefined:t.substring(0,e),r=e===-1?t:t.substring(e+1);return{model:n,path:r}}var b={autoWait:true,visible:true},M=new u,w=new a,I=new c;var x=function(t,e){var r=h([n,Object],t,e);this._oOpaInstance=r[0];return this.options(b,r[1])};x.defaultOptions=function(t){if(arguments.length>0){b=p(t)}return p(b)};x.create=function(t,e,o,i,u,a,c){var p=h([n,[String,RegExp],String,Boolean,[s,Function,Array,Object],[r,Function,Array],Object],t,e,o,i,u,a,c);return new x(p[0]).hasId(p[1]).hasType(p[2]).isDialogElement(!!p[3]).has(p[4]).do(p[5]).options(p[6])};x.prototype.options=function(t){this._oOptions=p.apply(this,[this._oOptions].concat(Array.prototype.slice.call(arguments)));return this};x.prototype.viewId=function(t){return this.options({viewId:t})};x.prototype.viewName=function(t){return this.options({viewName:t})};x.prototype.viewNamespace=function(t){return this.options({viewNamespace:t})};x.prototype.fragmentId=function(t){return this.options({fragmentId:t})};x.prototype.timeout=function(t){return this.options({timeout:t})};x.prototype.debugTimeout=function(t){return this.options({debugTimeout:t})};x.prototype.pollingInterval=function(t){return this.options({pollingInterval:t})};x.prototype.hasId=function(t){return this.options({id:t})};x.prototype.hasType=function(t){return this.options({controlType:t})};x.prototype.has=function(t,e){return this.options({matchers:e?t:l(t,this._oOptions.matchers)})};x.prototype.hasProperties=function(t){return this.has(x.Matchers.properties(t))};x.prototype.hasI18NText=function(t,e,n){return this.has(x.Matchers.i18n.apply(x.Matchers,arguments))};x.prototype.hasAggregation=function(t,e){return this.has(x.Matchers.aggregationMatcher(t,e))};x.prototype.hasAggregationProperties=function(t,e){return this.hasAggregation(t,x.Matchers.properties(e))};x.prototype.hasAggregationLength=function(t,e){return this.has(x.Matchers.aggregationLength(t,e))};x.prototype.hasConditional=function(t,e,n){return this.has(x.Matchers.conditional(t,e,n))};x.prototype.hasSome=function(t){return this.has(x.Matchers.some.apply(x.Matchers,arguments))};x.prototype.mustBeEnabled=function(t){return this.options({enabled:arguments.length?!!t:true})};x.prototype.mustBeVisible=function(t){return this.options({visible:arguments.length?!!t:true})};x.prototype.mustBeReady=function(t){return this.options({autoWait:arguments.length?!!t:true})};x.prototype.isDialogElement=function(t){return this.options({searchOpenDialogs:arguments.length?!!t:true})};x.prototype.check=function(t,e){return this.options({check:e?t:g(t,this._oOptions.check,true)})};x.prototype.checkNumberOfMatches=function(t){return this.check(function(e){if(!e){return t===0}if(!f(e,Array)){e=[e]}return e.length===t})};x.prototype.do=function(t,e){if(f(t,x)){return this.do(function(){return t.execute()})}return this.options({actions:e?t:l(t,this._oOptions.actions)})};x.prototype.doConditional=function(t,e,n){return this.do(x.Actions.conditional(t,e,n))};x.prototype.doPress=function(t){return this.do(x.Actions.press(t))};x.prototype.doEnterText=function(t,e,n,r){var o=h([String,Boolean,Boolean,String],t,e,n,r);return this.do(x.Actions.enterText(o[0],o[1],o[2],o[3]))};x.prototype.doOnAggregation=function(t,e,n){if(arguments.length<3){n=e;e=undefined}var r=x.Matchers.filter(e),o=A.bind(this,n);return this.do(function(e){r(m(e,t)).forEach(o)})};x.prototype.doOnChildren=function(t,e){if(!f(t,x)){t=new x(this._getOpaInstance(),t)}return this.do(function(n){var r=this.build(),o=t.build();o.searchOpenDialogs=r.searchOpenDialogs;o.matchers=l(x.Matchers.ancestor(n,e),o.matchers);return t._getOpaInstance().waitFor(o)}.bind(this))};x.prototype.description=function(t){return this.success(t+" - OK").error(t+" - FAILURE")};x.prototype.success=function(t,e){var n=y(t);return this.options({success:e?n:g(n,this._oOptions.success)})};x.prototype.error=function(t,e){if(f(t,String)){return this.options({errorMessage:t})}return this.options({error:e?t:g(t,this._oOptions.error)})};x.prototype.build=function(){if(!this._oOptions.errorMessage){this.error(d(this._oOptions))}return p(this._oOptions)};x.prototype.execute=function(t){if(f(t,n)){this._setOpaInstance(t)}return this._getOpaInstance().waitFor(this.build())};x.prototype._setOpaInstance=function(t){if(!f(t,n)){throw new Error("Opa5 instance expected")}this._oOpaInstance=t};x.prototype._getOpaInstance=function(){if(!f(this._oOpaInstance,n)){this._setOpaInstance(new n)}return this._oOpaInstance};x.Matchers={TRUE:function(){return true},FALSE:function(){return false},ancestor:function(t,e){return{ancestor:[[t,e]]}},descendant:function(t,e){return{descendant:[[t,e]]}},properties:function(t){return{properties:t}},i18n:function(t,e,n){var r=v(e),o=r.model||"i18n",i=r.path;if(arguments.length>3||n&&!Array.isArray(n)){n=Array.prototype.slice.call(arguments,2)}return{I18NText:{propertyName:t,modelName:o,key:i,parameters:n}}},resourceBundle:function(t,e,n,r){if(arguments.length>4||r&&!Array.isArray(r)){r=Array.prototype.slice.call(arguments,3)}return function(o){var i=sap.ui.getCore().getLibraryResourceBundle(e),s=i.getText(n,r),u={};u[t]=s;return O({properties:u},o)}},labelFor:function(t,e,n,r){var o=3,i;if(!f(e,Boolean)){o=2;r=n;n=e;e=false}if(e){return{labelFor:{propertyName:t,text:n}}}i=v(n);if(arguments.length>o+1||r&&!Array.isArray(r)){r=Array.prototype.slice.call(arguments,o)}return{labelFor:{propertyName:t,modelName:i.model||"i18n",key:i.path,parameters:r}}},aggregationMatcher:function(t,e){var n=x.Matchers.filter(e);return function(e){return n(m(e,t)).length>0}},aggregationLength:function(t,e){return{aggregationLengthEquals:{name:t,length:e}}},aggregationAtIndex:function(t,e){return function(n){var r=m(n,t);return r&&e<r.length?r[e]:undefined}},bindingProperties:function(t,e){return function(n){var r=n.getBindingContext(t),o,i;for(o in e){i=r.getProperty(o);if(i!==e[o]){return false}}return true}},bindingPath:function(t,e){var n=v(t);return{bindingPath:{modelName:n.model,path:n.path,propertyPath:e}}},customData:function(t){if(!t){return x.Matchers.TRUE}return function(e){if(!e||typeof e.data!=="function"){return false}return Object.keys(t).reduce(function(n,r){return n&&e.data(r)===t[r]},true)}},conditional:function(t,e,n){return function(r){if(O(t,r)){return O(e,r)}return n?O(n,r):true}},focused:function(t){return function(e){var n=e&&e.isA("sap.ui.core.Element")&&e.$();return n&&(n.is(":focus")||n.hasClass("sapMFocus")||t&&n.find(":focus").length>0)||false}},some:function(t){if(t.length>1||t&&!Array.isArray(t)){t=Array.prototype.slice.call(arguments,0)}return function(e){var n=false;if(t.some(function(t){n=O(t,e);return n})){return n}return false}},filter:function(t){return function(e){if(!f(e,Array)){e=[e]}return O(t,e)||[]}},match:function(t){return function(e){var n=O(t,[e]);return n.length?n[0]:false}}};x.Actions={press:function(t){return new o({idSuffix:t})},enterText:function(t,e,n,r){return new i({text:t,clearTextFirst:e,keepFocus:n,idSuffix:r})},conditional:function(t,e,n){var r=x.Matchers.match(t),o=e,i=n;if(f(e,x)){o=function(){return e.execute()}}if(n&&f(n,x)){i=function(){return n.execute()}}return function(t){if(r(t)){return A(o,t)}else if(i){return A(i,t)}}}};return x});